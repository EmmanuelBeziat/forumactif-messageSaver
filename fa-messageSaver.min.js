/*!
 * Nom: messageSaver
 * Version: 1.2
 * Description: Permet l'enregistrement automatique des messages dans les champs de post de forumactif
 * Auteur: Emmanuel "Manumanu" B
 * GitHub: https://github.com/EmmanuelBeziat/forumactif-messageSaver
 */
var messageSaver=function(e,a){"use strict";var t=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+a+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href),o=e("#text_editor_textarea").siblings('input[name="'+a+'"]').val();return null===r?o:r[1]},n=function(e,a,t,n){var r={userID:e,topicURL:n,message:a};localStorage.setItem(t,JSON.stringify(r))},r=function(e,a,t,n){var r,s=localStorage.getItem(t);"undefined"!=s?(r=JSON.parse(s),o(e,a.val(),t,n)?a.val(r.message):alert("Erreur 1:\nLa vérification du message enregistré a échoué.")):alert("Erreur 2: Il n'y a aucun message sauvegardé dans le WebStorage")},o=function(e,a,t,n){var r,o=localStorage.getItem(t);return"undefined"!=o?(r=JSON.parse(o),r.userID===e&&r.topicURL===n&&""===a?!0:!1):!1},s=function(){var a=window.location.host,o=_userdata.user_id,s=t("t"),i=e('form[action="/post"]'),u=i.find('input[name="post"]'),c=e("#text_editor_textarea").sceditor("instance");c.bind("keyup",function(){n(o,c.val(),a,s)}),localStorage.getItem(a)&&u.before('<input type="button" class="mainoption btn-loader" id="ms-loader" value="Charger le message sauvegardé" />&nbsp;&nbsp;'),i.on("click","#ms-loader",function(){r(o,c,a,s)})};return{init:s}}(jQuery);$(window).load(function(){"undefined"==typeof _userdata?console.log("L'objet \"_userdata\" de forumactif n'a pas été trouvé. Le script de sauvegarde des messages en cours d'écriture ne peut pas fonctionner."):messageSaver.init()});